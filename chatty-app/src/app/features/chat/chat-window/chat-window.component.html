<section class="window">
  <header class="flex items-center justify-between p-4">
    <div class="flex items-center gap-4">
      <div class="avatar">{{ title[0] || '?' }}</div>
      <div class="flex flex-col">
        <h2 class="text-base font-bold leading-tight title">{{ title || 'Conversation' }}</h2>
        <p class="status text-sm">{{ presenceLabel || '...' }}</p>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <button class="icon" type="button"><span class="material-symbols-outlined">call</span></button>
      <button class="icon" type="button"><span class="material-symbols-outlined">videocam</span></button>
      <button class="icon" type="button"><span class="material-symbols-outlined">more_vert</span></button>
    </div>
  </header>

  <div class="messages flex-1 p-4 md:p-6" #scroller>
    <div *ngIf="messages.length; else empty" class="flex flex-col gap-3">
      <div *ngFor="let m of messages" class="bubble" [class.me]="m.author === 'me'">
        <div class="text">{{ m.text }}</div>
        <div class="attachments" *ngIf="m.attachments?.length">
          <ng-container *ngFor="let a of m.attachments">
            <a
              *ngIf="a.contentType?.startsWith('image') || a.url.match(/\\.(png|jpe?g|gif|webp)$/i)"
              class="attachment image"
              [href]="a.url"
              target="_blank"
              rel="noreferrer"
            >
              <img [src]="a.url" [alt]="a.name || 'image attachment'" loading="lazy" />
            </a>
            <a
              *ngIf="!(a.contentType?.startsWith('image') || a.url.match(/\\.(png|jpe?g|gif|webp)$/i))"
              class="attachment file"
              [href]="a.url"
              target="_blank"
              rel="noreferrer"
            >
              <span class="material-symbols-outlined">attach_file</span>
              <div class="file-meta">
                <span class="name">{{ a.name || 'Attachment' }}</span>
              </div>
            </a>
          </ng-container>
        </div>
        <span class="time">{{ m.time }}</span>
      </div>
    </div>
    <ng-template #empty>
      <div class="flex flex-col items-center justify-center h-full text-center">
        <span class="material-symbols-outlined text-6xl mb-4">chat</span>
        <h3 class="text-xl font-semibold">Select a conversation</h3>
        <p class="mt-1 max-w-sm">Choose from your conversations or start a new one to begin chatting.</p>
      </div>
    </ng-template>
  </div>
</section>
